# IoT Sensor Management Server - Полная документация


# IoT Sensor Management Server

REST API сервер для управления IoT сенсорами. Реализует все требуемые функции для регистрации, мониторинга и управления сенсорами без использования базы данных (данные хранятся в памяти).

## Основные функции

- Регистрация новых сенсоров
- Просмотр всех зарегистрированных сенсоров
- Фильтрация сенсоров по статусу (online/offline)
- Получение данных с конкретного сенсора
- Удаление сенсоров из системы

## Эндпоинты API

### 1. Получение всех сенсоров
- **Метод:** `GET`
- **URL:** `/sensors`
- **Описание:** Возвращает список всех зарегистрированных сенсоров
- **Успешный ответ:** 
  - Код: 200 OK
  - Тело: Массив объектов сенсоров

### 2. Получение активных сенсоров
- **Метод:** `GET`
- **URL:** `/sensors/online`
- **Описание:** Возвращает только сенсоры со статусом "online"
- **Успешный ответ:** 
  - Код: 200 OK
  - Тело: Массив объектов активных сенсоров

### 3. Получение данных конкретного сенсора
- **Метод:** `GET`
- **URL:** `/sensors/{id}`
- **Описание:** Возвращает данные конкретного сенсора по его ID
- **Параметры:**
  - `id` - числовой идентификатор сенсора
- **Успешный ответ:** 
  - Код: 200 OK
  - Тело: Объект сенсора
- **Ошибки:**
  - 404 Not Found: если сенсор с указанным ID не существует

### 4. Регистрация нового сенсора
- **Метод:** `POST`
- **URL:** `/sensors`
- **Описание:** Добавляет новый сенсор в систему
- **Тело запроса (JSON):**
  ```json
  {
    "type": "температура",
    "location": "комната 1",
    "last_value": 25.5,
    "status": "online" // опционально
  }
  ```
- **Обязательные поля:** `type:String`, `location:String`, `last_value:float`
- **Успешный ответ:** 
  - Код: 201 Created
  - Тело: Созданный объект сенсора (с присвоенным ID)
- **Ошибки:**
  - 400 Bad Request: если отсутствуют обязательные поля или неверный тип данных

### 5. Удаление сенсора
- **Метод:** `DELETE`
- **URL:** `/sensors/{id}`
- **Описание:** Удаляет сенсор из системы по его ID
- **Параметры:**
  - `id` - числовой идентификатор сенсора
- **Успешный ответ:** 
  - Код: 200 OK
  - Тело: `{"message": "Sensor {id} deleted"}`
- **Ошибки:**
  - 404 Not Found: если сенсор с указанным ID не существует

## Структура данных сенсора

Каждый сенсор представлен объектом со следующими полями:

| Поле          | Тип      | Описание                                   | Обязательное | По умолчанию      |
|---------------|----------|--------------------------------------------|--------------|-------------------|
| id            | integer  | Уникальный идентификатор сенсора           | Авто-генерация | -                 |
| type          | string   | Тип сенсора (температура, влажность и т.д.) | Да           | -                 |
| location      | string   | Местоположение сенсора                     | Да           | -                 |
| last_value    | float    | Последнее значение с сенсора               | Да           | -                 |
| status        | string   | Текущий статус (online/offline)            | Нет          | "offline"         |
| last_updated  | string   | Время последнего обновления                | Нет          | Текущее время UTC |

## Установка и запуск

### Требования
- Python 3.7 или новее
- Установленный пакетный менеджер pip
- OS: Linux 5.10 and later (Debian 11\Ubuntu 22 or later), Windows Server 2016 and later, macOS 11 and later
- CPU: 1 core X86 or aarch64 CPU
- Memory: 256 MB RAM

### Шаги установки
0. Подготовьте окружение согласно требованиям
1. Клонируйте репозиторий (или создайте файлы вручную)
2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   ```
3. Активируйте виртуальное окружение:
   - Для Linux/MacOS:
     ```bash
     source venv/bin/activate
     ```
   - Для Windows:
     ```cmd
     venv\Scripts\activate
     ```
4. Установите зависимости:
   ```bash
   pip install flask pytest
   ```

### Запуск сервера
```bash
python app.py
```

Сервер будет доступен по адресу: `http://localhost:5000`

### Остановка сервера
Нажмите `Ctrl+C` в терминале, где запущен сервер

## Тестирование

### Установка тестовых зависимостей
```bash
pip install pytest
```

### Запуск тестов
```bash
pytest test_app.py -v
```

### Описание тестов
Тестовый набор включает 12 тестов (6 позитивных и 6 негативных сценариев):

1. Тесты для GET /sensors:
   - Получение пустого списка сенсоров
   - Получение списка с сенсорами

2. Тесты для GET /sensors/online:
   - Получение пустого списка активных сенсоров
   - Получение активных сенсоров
   - Проверка фильтрации по статусу

3. Тесты для GET /sensors/{id}:
   - Получение существующего сенсора
   - Получение несуществующего сенсора (ошибка 404)

4. Тесты для POST /sensors:
   - Успешная регистрация сенсора
   - Отсутствие обязательного поля (ошибка 400)
   - Неверный тип данных для last_value (ошибка 400)
   - Автоматическая установка временной метки

5. Тесты для DELETE /sensors/{id}:
   - Успешное удаление сенсора
   - Попытка удаления несуществующего сенсора (ошибка 404)

## Примеры использования

### Регистрация нового сенсора
```bash
curl -X POST -H "Content-Type: application/json" \
  -d '{"type": "влажность", "location": "теплица", "last_value": 65.7}' \
  http://localhost:5000/sensors
```

### Получение всех сенсоров
```bash
curl http://localhost:5000/sensors
```

### Получение активных сенсоров
```bash
curl http://localhost:5000/sensors/online
```

### Получение конкретного сенсора
```bash
curl http://localhost:5000/sensors/1
```

### Удаление сенсора
```bash
curl -X DELETE http://localhost:5000/sensors/1
```

## Особенности реализации
- Данные хранятся в оперативной памяти (не сохраняются между перезапусками)
- Автоматическая генерация ID для новых сенсоров
- Автоматическая установка временных меток при создании сенсора
- Валидация входных данных:
  - Проверка обязательных полей
  - Проверка типа данных для last_value
- Подробные сообщения об ошибках

## Структура проекта
```
iot-sensor-server/
├── app.py         # Основной файл приложения
├── test_app.py    # Тесты
├── README.md      # Данная документация
└── venv/          # Виртуальное окружение (создается после установки)
```
```